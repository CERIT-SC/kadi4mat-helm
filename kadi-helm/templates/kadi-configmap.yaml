apiVersion: v1
kind: ConfigMap
metadata:
  name: "{{ .Release.Name }}-configmap"
data:
  kadi.py: |
    import os
    AUTH_PROVIDERS = [{"type": "local"}]
    SERVER_NAME = {{ .Values.hostname | quote }}
    SECRET_KEY = os.getenv("KADI_SECRET_KEY")
    SQLALCHEMY_DATABASE_URI = {{ if .Values.database.internal }}"postgresql://{{ .Values.database.internalDBSettings.username }}:{{ .Values.database.internalDBSettings.password }}@{{ .Release.Name }}-postgres-rw/kadi"{{- else }}{{ .Values.database.connectionString | quote }}{{- end }}
    STORAGE_PATH = "/opt/kadi/storage"
    MISC_UPLOADS_PATH = "/opt/kadi/uploads"
    SMTP_HOST = "localhost"
    SMTP_PORT = 25
    SMTP_USERNAME = ""
    SMTP_PASSWORD = ""
    ELASTICSEARCH_HOSTS = {{ if .Values.elasticsearch.internal }}"http://{{ .Release.Name }}-elasticsearch:9200"{{- else }}{{ .Values.elasticsearch.connectionString | quote }}{{- end }}
    RATELIMIT_STORAGE_URI = {{ if .Values.redis.internal }}"redis://{{ .Release.Name }}-redis:6379/0"{{- else }}{{ .Values.redis.connectionString | quote }}{{- end }}
    CELERY_BROKER_URL = {{ if .Values.redis.internal }}"redis://{{ .Release.Name }}-redis:6379/0"{{- else }}{{ .Values.redis.connectionString | quote }}{{- end }}